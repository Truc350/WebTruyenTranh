<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Profile</title>
    <link rel="stylesheet" href="../css/adminCss/styleProfile.css">
    <link rel="stylesheet" href="../css/adminCss/styleSidebar.css">
    <link rel="stylesheet" href="../css/adminCss/adminHeader.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
</head>
<body>


<div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="../../img/logo.png" alt="Logo" class="logo">
            <h2>Comic Store</h2>
        </div>

        <ul>
            <li>
                <a href="dashboard.html">
                    <img src="../../img/home.png" class="icon">
                    <span>Trang chủ</span>
                </a>
            </li>
            <li>
                <a href="productManagement.html">
                    <img src="../../img/product.png" class="icon">
                    <span>Quản lý sản phẩm</span>
                </a>
            </li>
            <li>
                <a href="category.html">
                    <img src="../../img/category.png" class="icon">
                    <span>Quản lý thể loại</span>
                </a>
            </li>
            <li>
                <a href="order.html">
                    <img src="../../img/order.png" class="icon">
                    <span>Quản lý đơn hàng</span>
                </a>
            </li>
            <li>
                <a href="userManagement.html">
                    <img src="../../img/user.png" class="icon">
                    <span>Quản lý người dùng</span>
                </a>
            </li>
            <li>
                <a href="promotion.html">
                    <img src="../../img/promo.png" class="icon">
                    <span>Quản lý khuyến mãi</span>
                </a>
            </li>
            <li>
                <a href="report.html">
                    <img src="../../img/report.png" class="icon">
                    <span>Thống kê</span>
                </a>
            </li>
        </ul>
    </aside>

    <div class="main-content">
        <header class="admin-header">
            <div class="header-right">
                <a href="chatWithCus.html">
                    <i class="fa-solid fa-comment"></i>
                </a>

                <div class="admin-profile">
                    <img src="../../img/admin.png" class="admin-avatar" alt="Admin">
                    <span class="admin-name">Admin</span>
                </div>

                <!-- Nút đăng xuất -->
                <button class="btn-logout" title="Đăng xuất">
                    <a href="../public/login.html">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </a>
                </button>
            </div>
        </header>

        <!-- profile page (simple) -->
        <div class="profile-page">
            <!-- LEFT SIDE -->
            <div class="profile-left">
                <div class="avatar-box">
                    <div class="avatar-wrapper">
                        <img id="avatar-img" src="../../img/admin.png" alt="Avatar">
                        <div class="avatar-overlay">
                            <i class="fa-solid fa-camera"></i>
                        </div>
                        <input type="file" id="avatar-upload" accept="image/*" hidden>
                    </div>
                    <h3>Nguyễn Ngọc Linh</h3>
                </div>
            </div>

            <!-- RIGHT SIDE -->
            <div class="profile-right">
                <!-- Thông tin cơ bản -->
                <h4>Thông tin cơ bản</h4>
                <form id="profileForm">
                    <label>Họ tên
                        <input name="fullname" value="Nguyễn Ngọc Linh">
                    </label>
                    <label>Email
                        <input type="email" name="email" value="linhnguyen123@gmail.com">
                    </label>
                    <label>Số điện thoại
                        <input name="phone" value="0123456789">
                    </label>
                    <label>Tên cửa hàng
                        <input name="storeName" value="Comic Store">
                    </label>
                    <div class="actions">
                        <button type="submit" class="btn">Lưu thay đổi</button>
                    </div>
                </form>

                <hr>

                <!-- Thông tin thanh toán -->
                <h4>Thông tin ngân hàng</h4>

                <!-- Hiển thị Bản đọc (masked) -->
                <div class="bank-container">
                <div class="bank-info" id="bankView">
                    <button id="btn-edit-bank" class="edit-btn" title="Chỉnh sửa">
                        <i class="fa-solid fa-pen-to-square"></i>
                    </button>

                    <p><strong>Ngân hàng:</strong> <span id="bankNameText">Vietcombank</span></p>
                    <p><strong>Số tài khoản:</strong> <span id="acctMasked">**** **** 1234</span></p>
                    <p><strong>Chủ tài khoản:</strong> <span id="acctNameText">Nguyễn Ngọc Linh</span></p>

                    <div id="qrContainerView" style="margin-top: 12px; text-align: center;">
                        <p><strong>Mã QR thanh toán:</strong></p>
                        <img src="../../img/qr.jpg" alt="QR Code" style="width: 120px; height: 120px; border: 1px dashed #ccc; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    </div>
                </div>


                <div class="bank-info-edit hidden" id="bankEdit">
                    <form id="bankForm">
                        <label>Ngân hàng
                            <select name="bankName" id="bankName" required>
                                <option value="">-- Chọn ngân hàng --</option>
                                <option value="Momo">Momo</option>
                                <option value="VNPay">VNPay</option>
                                <option value="Vietcombank">Vietcombank</option>
                                <option value="BIDV">BIDV</option>
                                <option value="Techcombank">Techcombank</option>
                                <option value="MB Bank">MB Bank</option>
                                <option value="Agribank">Agribank</option>
                                <option value="ACB">ACB</option>
                                <option value="Sacombank">Sacombank</option>
                            </select>
                        </label>

                        <label>Số tài khoản
                            <div class="account-field">
                                <input name="accountNumber" id="accountNumber" value="12341234" required>
                                <i id="toggleEye" class="fa-solid fa-eye"></i>
                            </div>
                        </label>

                        <label>Chủ tài khoản
                            <input name="accountHolder" id="accountHolder" value="Nguyễn Ngọc Linh" required>
                        </label>

                        <label>Mã QR thanh toán
                            <div class="qr-upload-wrapper" style="margin-top: 8px; text-align: center;">
                                <div class="qr-upload-box">
                                    <img id="qrPreviewImg" src="" alt="QR Preview"
                                         style="width: 120px; height: 120px; border: 1px dashed #ccc; border-radius: 6px; display: none;">
                                    <div class="qr-plus-icon">
                                        <i class="fa-solid fa-plus"></i>
                                    </div>
                                </div>
                                <input type="file" id="qrUpload" accept="image/*" hidden>
                            </div>
                        </label>

                        <div class="btn-group">
                            <button type="submit" class="btn">Lưu</button>
                            <button type="button" id="btnCancelBank" class="btn btn-secondary">Hủy</button>
                        </div>
                    </form>
                </div>
                </div>

                <hr>

                <!-- Lịch sử hoạt động -->
                <h4>Lịch sử hoạt động gần đây</h4>
                <div class="activity-log">
                    <table>
                        <thead>
                        <tr>
                            <th>Thời gian</th>
                            <th>Hoạt động</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr>
                            <td>12/11/2025 10:32</td>
                            <td>Đăng nhập vào hệ thống</td>
                        </tr>
                        <tr>
                            <td>11/11/2025 15:20</td>
                            <td>Chỉnh sửa khuyến mãi “Sale 11.11”</td>
                        </tr>
                        <tr>
                            <td>10/11/2025 09:10</td>
                            <td>Duyệt đơn hàng #DH0052</td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <hr>

                <!-- Đổi mật khẩu -->
                <h4>Đổi mật khẩu</h4>
                <form id="changePassForm">
                    <small class="password-hint">
                        Mật khẩu phải có ít nhất 8 ký tự, bao gồm chữ hoa, chữ thường, số và ký tự đặc biệt.
                    </small>
                    <label>Mật khẩu cũ
                        <input type="text" name="oldPassword" required>
                    </label>
                    <label>Mật khẩu mới
                        <input type="text" name="newPassword" required minlength="8">
                    </label>
                    <label>Xác nhận mật khẩu
                        <input type="text" name="confirmPassword" required>
                    </label>
                    <div class="actions">
                        <button type="submit" class="btn btn-primary">Đổi mật khẩu</button>
                    </div>
                    <p id="passMsg" class="muted"></p>
                </form>
            </div>
        </div>


    </div>
</div>

<script>
    // === TOÀN BỘ JS NGÂN HÀNG: POPUP + TOGGLE EYE + QR (KHÔNG LƯU) ===
    document.addEventListener("DOMContentLoaded", function () {
        // === ELEMENTS ===
        const bankView = document.getElementById('bankView');
        const bankEdit = document.getElementById('bankEdit');
        const btnEdit = document.getElementById('btn-edit-bank');
        const btnCancel = document.getElementById('btnCancelBank');
        const bankForm = document.getElementById('bankForm');
        const saveBtn = bankForm.querySelector('button[type="submit"]');

        const accountNumberInput = document.getElementById('accountNumber');
        const toggleEye = document.getElementById('toggleEye');
        const acctMasked = document.getElementById('acctMasked');

        const qrUpload = document.getElementById('qrUpload');
        const qrPreviewImg = document.getElementById('qrPreviewImg');
        const qrUploadBox = document.querySelector('.qr-upload-box');

        // === DỮ LIỆU GIẢ LẬP ===
        let actualAcct = accountNumberInput.value || '12341234';
        let masked = true;

        // === MASK SỐ TÀI KHOẢN ===
        function maskAccount(acct) {
            const s = (acct || '').toString().replace(/\s+/g, '').replace(/[^0-9]/g, '');
            if (!s) return '----';
            const last4 = s.slice(-4);
            const maskedPart = s.slice(0, -4).replace(/\d/g, '*');
            return (maskedPart + last4).replace(/(.{4})/g, '$1 ').trim();
        }

        function updateMasked() {
            acctMasked.textContent = maskAccount(actualAcct);
        }

        // === TOGGLE EYE (HIỆN/ẨN SỐ TK) ===
        toggleEye.addEventListener('click', () => {
            masked = !masked;
            if (masked) {
                accountNumberInput.value = maskAccount(actualAcct);
                toggleEye.classList.replace('fa-eye-slash', 'fa-eye');
            } else {
                accountNumberInput.value = actualAcct;
                toggleEye.classList.replace('fa-eye', 'fa-eye-slash');
            }
        });

        // === CHỌN ẢNH QR ===
        qrUpload.addEventListener('change', function () {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => {
                    qrPreviewImg.src = e.target.result;
                    qrPreviewImg.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                qrPreviewImg.style.display = 'none';
            }
        });

        // === MỞ POPUP ===
        btnEdit.addEventListener('click', () => {
            bankView.classList.add('hidden');
            bankEdit.classList.remove('hidden');

            // Khôi phục số TK + trạng thái mắt
            accountNumberInput.value = masked ? maskAccount(actualAcct) : actualAcct;
            toggleEye.classList.toggle('fa-eye-slash', !masked);
            toggleEye.classList.toggle('fa-eye', masked);

        });

        // === HỦY ===
        btnCancel.addEventListener('click', () => {
            bankEdit.classList.add('hidden');
            bankView.classList.remove('hidden');
            qrUpload.value = '';
            qrPreviewImg.style.display = 'none';
        });
        saveBtn.disabled = true;
        // === KHỞI TẠO ===
        updateMasked();
    });

    // chọn ảnh qr trong popup
    document.addEventListener('click', function (e) {
        if (e.target.closest('.qr-upload-box')) {
            e.preventDefault();
            const input = document.getElementById('qrUpload');
            if (input) input.click();
        }
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const wrapper = document.querySelector(".avatar-wrapper");
        const upload = document.querySelector("#avatar-upload");
        const img = document.querySelector("#avatar-img");

        // Khi click vào avatar => mở hộp chọn ảnh
        wrapper.addEventListener("click", () => upload.click());

        // Khi người dùng chọn ảnh mới => hiển thị preview
        upload.addEventListener("change", (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = () => (img.src = reader.result);
                reader.readAsDataURL(file);
            }
        });
    });
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const current = window.location.pathname.split("/").pop();
        const links = document.querySelectorAll(".sidebar li a");

        links.forEach(link => {
            const linkPage = link.getAttribute("href");

            if (linkPage === current) {
                link.classList.add("active");
            }
        });
    });
</script>

</body>
</html>