<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Quản lý sản phẩm</title>
    <link rel="stylesheet" href="../css/adminCss/stylePro.css">
    <link rel="stylesheet" href="../css/adminCss/styleSidebar.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="stylesheet" href="../css/adminCss/adminHeader.css">
</head>
<body>
<div class="container">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <img src="../../img/logo.png" alt="Logo" class="logo">
            <h2>Comic Store</h2>
        </div>

        <ul>
            <li>
                <a href="dashboard.html">
                <img src="../../img/home.png" class="icon">
                <span>Trang chủ</span>
                </a>
            </li>
            <li>
                <a href="productManagement.html">
                <img src="../../img/product.png" class="icon">
                <span>Quản lý sản phẩm</span>
                </a>
            </li>
            <li>
                <a href="category.html">
                <img src="../../img/category.png" class="icon">
                <span>Quản lý thể loại</span>
                </a>
            </li>
            <li>
                <a href="order.html">
                <img src="../../img/order.png" class="icon">
                <span>Quản lý đơn hàng</span>
                </a>
            </li>
            <li>
                <a href="userManagement.html">
                <img src="../../img/user.png" class="icon">
                <span>Quản lý người dùng</span>
                </a>
            </li>
            <li>
                <a href="promotion.html">
                <img src="../../img/promo.png" class="icon">
                <span>Quản lý khuyến mãi</span>
                </a>
            </li>
            <li>
                <a href="report.html">
                <img src="../../img/report.png" class="icon">
                <span>Thống kê</span>
                </a>
            </li>
        </ul>
    </aside>

    <!-- Main content -->
    <main class="main-content">
        <header class="admin-header">
            <div class="header-right">
                <a href="chatWithCus.html">
                <i class="fa-solid fa-comment"></i>
                </a>

                <div class="admin-profile">
                    <a href="profileAdmin.html">
                    <img src="../../img/admin.png" class="admin-avatar" alt="Admin">
                    </a>
                    <span class="admin-name">Admin</span>
                </div>

                <!-- Nút đăng xuất -->
                <button class="btn-logout" title="Đăng xuất">
                    <a href="../public/login.html">
                        <i class="fa-solid fa-right-from-bracket"></i>
                    </a>
                </button>
            </div>
        </header>
        <h2 class="page-title">Quản lý sản phẩm</h2>

        <div class="table-container">
            <div class="search-add">
                <div class="search-box">
                <input type="text" placeholder="Tìm kiếm truyện...">
                    <i class="fas fa-magnifying-glass"></i>
                </div>

                <div class="action-buttons">
                    <button class="add-btn">+ Thêm truyện</button>
                    <button class="delete-btn">Xóa</button>
                </div>
            </div>
        </div>

        <div class="table-wrapper">
        <table>
            <thead>
            <tr>
                <th>Mã truyện</th>
                <th>Tên truyện</th>
                <th>Thể loại</th>
                <th>Tác giả</th>
                <th>Giá</th>
                <th>Còn trong kho</th>
                <th>Đánh giá</th>
                <th></th>
            </tr>
            </thead>
            <tbody id="productTableBody">
            <tr>
                <td>TT001</td>
                <td>Thám tử lừng danh Conan</td>
                <td>Trinh thám</td>
                <td>Gosho Aoyama</td>
                <td>22,500₫</td>
                <td>550 quyển</td>
                <td class="review-cell">
                    <button class="view-review-btn"  data-comic="TT001" title="Xem review"><i class="fas fa-eye"></i></button>
                </td>
                <td class="action-cell">
                    <button class="edit-btn">Sửa</button>
                    <div class="menu-container">
                        <button class="more-btn">⋮</button>
                        <div class="dropdown-menu">
                            <label><input type="radio" name="display" checked> Hiển thị</label>
                            <label><input type="radio" name="display"> Ẩn sản phẩm</label>
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td>TT002</td>
                <td>Doraemon</td>
                <td>Hài hước</td>
                <td>Fujiko F. Fujio</td>
                <td>18,000₫</td>
                <td>320 quyển</td>
                <td class="review-cell">
                    <button class="view-review-btn" title="Xem review">
                        <i class="fas fa-eye"></i></button>
                </td>
                <td class="action-cell">
                    <button class="edit-btn">Sửa</button>
                    <div class="menu-container">
                        <button class="more-btn">⋮</button> <!--menu-btn-->
                        <div class="dropdown-menu"> <!--menu-options-->
                            <label><input type="radio" name="display" checked> Hiển thị</label>
                            <label><input type="radio" name="display"> Ẩn sản phẩm</label>
                        </div>
                    </div>
                </td>
            </tr>

            <tr class="pagination-row">
                <td colspan="10">
                    <div class="pagination">
                        <button class="page-btn product-page" data-page="1">1</button>
                        <button class="page-btn product-page" data-page="2">2</button>
                        <button class="page-btn product-page" data-page="3">3</button>
                    </div>
                </td>
            </tr>

            </tbody>
        </table>
        </div>

        <!-- POPUP THÊM TRUYỆN -->
        <div class="modal-overlay" id="addModal">
            <div class="modal-rectangle">
                <h3>Thêm truyện mới</h3>
                <form id="addForm" class="form-horizontal">
                    <div class="form-left">

                        <!-- HÀNG MÃ TRUYỆN + SỐ LƯỢNG -->
                        <div class="form-group two-columns">
                            <div>
                                <label>Mã truyện:</label>
                                <input type="text" placeholder="Nhập mã truyện">
                            </div>
                            <div>
                                <label>Số lượng:</label>
                                <input type="number" min="1">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Tên truyện:</label>
                            <input type="text" placeholder="Nhập tên truyện">
                        </div>

                        <div class="form-group">
                            <label>Thể loại:</label>
                            <select>
                                <option>Trinh thám</option>
                                <option>Hài hước</option>
                                <option>Tình cảm</option>
                                <option>Hành động</option>
                                <option>Kinh dị</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Tác giả:</label>
                            <input type="text" placeholder="Nhập tên tác giả">
                        </div>

                        <div class="form-group">
                            <label>Ngày đăng:</label>
                            <input type="date">
                        </div>
                    </div>

                    <div class="form-right">
                        <div class="image-upload vertical" id="imageBox">
                            <input type="file" id="imageInput" accept="image/*" hidden>
                            <div class="upload-placeholder" id="imagePreview">
                                <i class="icon">+</i>
                                <img id="previewImg" src="" alt="Preview" style="display:none;">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Mô tả ngắn:</label>
                            <textarea rows="4" placeholder="Nhập mô tả ngắn..."></textarea>
                        </div>
                    </div>
                </form>

                <div class="form-buttons">
                    <button type="button" class="cancel-btn">Hủy</button>
                    <button type="submit" class="save-btn">Lưu</button>
                </div>
            </div>
        </div>

        <!-- POPUP SỬA TRUYỆN -->
        <div class="modal-overlay" id="editModal">
            <div class="modal-rectangle">
                <h3>Chỉnh sửa truyện</h3>

                <form id="editForm" class="form-horizontal">
                    <div class="form-left">

                        <!-- HÀNG MÃ TRUYỆN + SỐ LƯỢNG -->
                        <div class="form-group two-columns">
                            <div>
                                <label>Mã truyện:</label>
                                <input type="text" value="TT001" readonly>
                            </div>
                            <div>
                                <label>Số lượng:</label>
                                <input type="number" min="1" value="550">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Tên truyện:</label>
                            <input type="text" value="Thám tử lừng danh Conan">
                        </div>

                        <div class="form-group">
                            <label>Thể loại:</label>
                            <select>
                                <option selected>Trinh thám</option>
                                <option>Hài hước</option>
                                <option>Tình cảm</option>
                                <option>Hành động</option>
                                <option>Kinh dị</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Tác giả:</label>
                            <input type="text" value="Gosho Aoyama">
                        </div>

                        <div class="form-group">
                            <label>Ngày đăng:</label>
                            <input type="date" value="2024-12-01">
                        </div>
                    </div>

                    <div class="form-right">
                        <div class="image-upload vertical" id="editImageBox">
                            <input type="file" id="editImageInput" accept="image/*" hidden>
                            <div class="upload-placeholder" id="editImagePreview">
                                <img id="editPreviewImg"
                                     src="../../img/biaTruyen.jpg"
                                     alt="Preview">
                                <!-- overlay hiển thị icon + khi hover -->
                                <div class="upload-overlay">
                                    <i class="icon">+</i>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Mô tả ngắn:</label>
                            <textarea rows="4">Bộ truyện trinh thám nổi tiếng của Gosho Aoyama.</textarea>
                        </div>
                    </div>
                </form>

                <div class="form-buttons">
                    <button type="button" class="cancel-btn">Hủy</button>
                    <button type="submit" class="save-btn">Thay đổi</button>
                </div>
            </div>
        </div>



        <!-- POPUP XÓA TRUYỆN -->
        <div class="modal-overlay" id="deleteModal">
            <div class="delete-modal">
                <h3>Xóa truyện</h3>

                <div class="search-bar">
                    <input type="text" id="searchInput" placeholder="Tìm truyện để xóa...">
                    <button id="searchBtn" class="search-icon">
                        <i class="fa-solid fa-magnifying-glass"></i>
                    </button>
                </div>

                <div class="delete-list">
                    <label><input type="checkbox"> Thám tử lừng danh Conan – Gosho Aoyama (2024-12-01)</label>
                    <label><input type="checkbox"> Doraemon – Fujiko F. Fujio (2024-11-15)</label>
                    <label><input type="checkbox"> One Piece – Eiichiro Oda (2024-10-10)</label>
                    <label><input type="checkbox"> Attack on Titan – Hajime Isayama (2024-08-05)</label>
                    <label><input type="checkbox"> Naruto – Masashi Kishimoto (2024-07-20)</label>
                    <label><input type="checkbox"> Bleach – Tite Kubo (2024-06-10)</label>
                    <label><input type="checkbox"> Spy x Family – Tatsuya Endo (2024-05-15)</label>
                    <label><input type="checkbox"> Bleach – Tite Kubo (2024-06-10)</label>
                    <label><input type="checkbox"> Spy x Family – Tatsuya Endo (2024-05-15)</label>
                    <label><input type="checkbox"> Bleach – Tite Kubo (2024-06-10)</label>
                    <label><input type="checkbox"> Spy x Family – Tatsuya Endo (2024-05-15)</label>
                </div>

                <div class="delete-buttons">
                    <button class="cancel-btn">Hủy</button>
                    <button class="delete-confirm-btn">Xóa</button>
                </div>
            </div>
        </div>


        <!-- POPUP XÁC NHẬN XÓA -->
        <div class="modal-overlay" id="confirmDeleteModal">
            <div class="confirm-box">
                <p>Bạn có chắc muốn xóa truyện không?</p>
                <div class="confirm-buttons">
                    <button class="cancel-btn">Hủy</button>
                    <button class="delete-confirm-btn">Xác nhận</button>
                </div>
            </div>
        </div>

        <!-- POPUP REVIEW -->
        <div class="modal-overlay review-popup" id="review-TT001">
            <div class="modal-rectangle">
<!--                <h3>Review: Thám tử lừng danh Conan</h3>-->

                <div class="review-list">
                    <div class="review-item">
                        <p><strong>Nguyễn Văn A</strong> -
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                        </p>
                        <p>Shop đóng gói cẩn thận, bọc nilon và seal đều rất chu đáo, còn bọc thêm chống sốc và bìa cứng để truyện không bị hư hại gì. Nhất định sẽ mua lại ạ :3</p>
                        <div>
                            <img src="../../img/review1.png" alt="review">
                            <img src="../../img/review2.png" alt="review">
                            <img src="../../img/review3.png" alt="review">
                        </div>
                    </div>

                    <div class="review-item">
                        <p><strong>Trần Thị B</strong> -
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i></p>
                        <p>Shop giao hàng nhanh chóng gói hàng cũng kỹ lưỡng nha chu đáo nhắn tin với khách.</p>
                        <div>
                            <img src="../../img/review4.png" alt="review">
                        </div>
                    </div>

                    <div class="review-item">
                        <p><strong>Trần Thị B</strong> -
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i>
                            <i class="fa-solid fa-star"></i></p>
                        <p>Shop giao hàng nhanh chóng gói hàng cũng kỹ lưỡng nha chu đáo nhắn tin với khách.</p>
                        <div>
                            <img src="../../img/review4.png" alt="review">
                        </div>
                    </div>
                </div>

                <div class="form-buttons">
                    <button type="button" class="cancel-btn close-review-btn">Đóng</button>
                </div>
            </div>
        </div>

    </main>

</div>


<!--action của hiện/ ẩn sản phẩm-->
<script>
    document.querySelectorAll('.more-btn').forEach(btn => {
        btn.addEventListener('click', function (e) {
            e.stopPropagation();

            // Đóng menu khác nếu có
            document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none');

            const menu = this.nextElementSibling; // menu nằm ngay sau nút 3 chấm
            const rect = this.getBoundingClientRect(); // tọa độ nút 3 chấm

            // Đặt vị trí menu ngay dưới nút 3 chấm
            menu.style.display = 'block';
            menu.style.top = rect.bottom + 'px';
            menu.style.left = (rect.right - menu.offsetWidth) + 'px';
        });
    });

    // Ẩn menu khi click ra ngoài
    document.addEventListener('click', () => {
        document.querySelectorAll('.dropdown-menu').forEach(m => m.style.display = 'none');
    });
</script>

<!--THEM TRUYEN-->
<script>
    const addBtn = document.querySelector('.add-btn');
    const modal = document.getElementById('addModal');
    const cancelBtn = document.querySelector('.cancel-btn');
    const imageBox = document.getElementById('imageBox');
    const imageInput = document.getElementById('imageInput');
    const previewImg = document.getElementById('previewImg');
    const imagePlaceholder = document.getElementById('imagePreview');

    addBtn.addEventListener('click', () => {
        modal.style.display = 'flex';
    });

    cancelBtn.addEventListener('click', () => {
        modal.style.display = 'none';
        imageInput.value = "";
        previewImg.style.display = "none";
    });

    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });

    // Khi click vào khung ảnh thì mở chọn file
    imageBox.addEventListener('click', () => {
        imageInput.click();
    });

    // Khi chọn file xong thì hiển thị preview
    imageInput.addEventListener('change', () => {
        const file = imageInput.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                previewImg.src = e.target.result;
                previewImg.style.display = "block";
            };
            reader.readAsDataURL(file);
        }
    });
</script>

<script>
    // === MỞ POPUP SỬA ===
    document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.getElementById('editModal').style.display = 'flex';
        });
    });

    // === MỞ POPUP XÓA ===
    document.querySelector('.delete-btn').addEventListener('click', () => {
        document.getElementById('deleteModal').style.display = 'flex';
    });

    // === ĐÓNG POPUP KHI NHẤN HỦY ===
    document.querySelectorAll('.cancel-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            const modal = e.target.closest('.modal-overlay');
            if (modal) {
                modal.style.display = 'none';
            }
        });
    });

    // === KHI NHẤN XÓA TRONG POPUP DANH SÁCH ===
    document.querySelectorAll('.delete-confirm-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.getElementById('confirmDeleteModal').style.display = 'flex';
        });
    });

    // === TÌM KIẾM TRUYỆN TRONG POPUP XÓA ===
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    const deleteList = document.querySelector('.delete-list');

    if (searchBtn && searchInput && deleteList) {
        searchBtn.addEventListener('click', () => {
            const keyword = searchInput.value.toLowerCase().trim();
            const labels = deleteList.querySelectorAll('label');
            labels.forEach(label => {
                const text = label.textContent.toLowerCase();
                label.style.display = text.includes(keyword) ? 'block' : 'none';
            });
        });

        // Nhấn Enter để tìm
        searchInput.addEventListener('keypress', e => {
            if (e.key === 'Enter') searchBtn.click();
        });
    }


    // === XỬ LÝ ẢNH TRONG POPUP SỬA ===
    const editImageBox = document.getElementById('editImageBox');
    const editImageInput = document.getElementById('editImageInput');
    const editPreviewImg = document.getElementById('editPreviewImg');

    // Nhấn vào khung để mở chọn ảnh
    editImageBox.addEventListener('click', () => {
        editImageInput.click();
    });

    // Hiển thị ảnh xem trước
    editImageInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                editPreviewImg.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    });

</script>

<script>
    (function(){
        const ROWS_PER_PAGE = 5;
        const tbody = document.getElementById('productTableBody');
        const rows = Array.from(tbody.querySelectorAll('tr')).filter(r => !r.classList.contains('pagination-row'));
        const pageButtons = document.querySelectorAll('.product-page');

        function showPage(page){
            const start = (page - 1) * ROWS_PER_PAGE;
            const end = start + ROWS_PER_PAGE;

            rows.forEach((r, idx) => {
                r.style.display = (idx >= start && idx < end) ? "" : "none";
            });

            pageButtons.forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.product-page[data-page="${page}"]`)?.classList.add('active');
        }

        pageButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                showPage(Number(btn.dataset.page));
            });
        });

        showPage(1);
    })();
</script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const current = window.location.pathname.split("/").pop();
        const links = document.querySelectorAll(".sidebar li a");

        links.forEach(link => {
            const linkPage = link.getAttribute("href");

            if (linkPage === current) {
                link.classList.add("active");
            }
        });
    });
</script>

    <script>
        document.querySelectorAll('.view-review-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const comicId = btn.dataset.comic;
                const popup = document.getElementById(`review-${comicId}`);
                if (popup) popup.style.display = 'flex';
            });
        });

        // Đóng popup
        document.querySelectorAll('.close-review-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                btn.closest('.review-popup').style.display = 'none';
            });
        });

        // Click ngoài popup cũng đóng
        document.querySelectorAll('.review-popup').forEach(popup => {
            popup.addEventListener('click', (e) => {
                if (e.target === popup) popup.style.display = 'none';
            });
        });
    </script>

</body>
</html>